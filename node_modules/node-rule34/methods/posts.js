const axios = require('axios');
const typeChecker = require('../modules/typeChecker.js');

module.exports = (options) => {
  let tags = options.tags;
  let limit = options.limit;
  let pid = options.pid;
  typeChecker(tags, "array");
  typeChecker(limit, "number");
  typeChecker(pid, "number");
  
  if(limit > 100) {
    return new Error("How about no. Limit is 100 max.")
  }

  const url = `https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&tags=${tags.join("+")}&limit=${limit}&pid=${pid}&json=1`;

  axios.get(url).then(d => {
    let arr = [];
    for(let i = 0; i < d.data.length; i++) {
      let y = {};
      let r = d.data[i];
      y.owner = r.owner;
      y.fileUrl = r.file_url;
      y.score = r.score;
      y.source = r.source;
      y.tags = r.tags;
      y.id = r.id;
      arr.push(y);
    }
    return arr;
  })
}